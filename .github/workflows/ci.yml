name: CI

on:
  pull_request:
    branches: ["main"]
  push:
    branches: ["main"]

jobs:
  hygiene:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Validate VERSION format
        run: |
          test -f VERSION
          VERSION_VALUE=$(cat VERSION)
          echo "VERSION=$VERSION_VALUE"
          echo "$VERSION_VALUE" | grep -E '^[0-9]+\.[0-9]+\.[0-9]+$'

      - name: Validate CHANGELOG contains current version
        run: |
          test -f CHANGELOG.md
          VERSION_VALUE=$(cat VERSION)
          grep -q "## \[$VERSION_VALUE\]" CHANGELOG.md

      - name: Validate issue templates exist
        run: |
          test -f .github/ISSUE_TEMPLATE/feature.yml
          test -f .github/ISSUE_TEMPLATE/bug.yml
          test -f .github/ISSUE_TEMPLATE/tech_debt.yml
          test -f .github/ISSUE_TEMPLATE/spike.yml

      - name: Validate docs workflow exists
        run: |
          test -f docs/WORKFLOW.md

      - name: Validate safe update guardrail exists
        run: |
          test -x scripts/safe_core_update.sh
          grep -q "Garantia de n√£o sobrescrita em updates" README.md
